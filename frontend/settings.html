<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SenseLense ‚Äî Settings</title>
    <meta name="description" content="Configure SenseLense: API keys, backend URL, appearance, and preferences." />
    <link rel="stylesheet" href="css/styles.css" />
    <script>
        /* Apply saved theme + accent color immediately */
        (function () {
            var t = localStorage.getItem('sl-theme');
            if (t === 'light') document.documentElement.setAttribute('data-theme', 'light');
            var accent = localStorage.getItem('sl-accent');
            if (accent) {
                var r = parseInt(accent.slice(1, 3), 16), g = parseInt(accent.slice(3, 5), 16), b = parseInt(accent.slice(5, 7), 16);
                var root = document.documentElement;
                root.style.setProperty('--red', accent);
                root.style.setProperty('--red-light', 'rgb(' + Math.min(255, r + 30) + ',' + Math.min(255, g + 30) + ',' + Math.min(255, b + 30) + ')');
                root.style.setProperty('--red-dark', 'rgb(' + Math.floor(r * .72) + ',' + Math.floor(g * .72) + ',' + Math.floor(b * .72) + ')');
                root.style.setProperty('--red-glow', 'rgba(' + r + ',' + g + ',' + b + ',.25)');
                root.style.setProperty('--border-red', 'rgba(' + r + ',' + g + ',' + b + ',.4)');
            }
        })();
    </script>
<script src="js/auth.js"></script>
</head>

<body>
    <div class="app-shell">

        <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar__logo">
                <svg id="adp-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"
                    style="height:36px;width:auto;color:var(--red);transition:color .2s ease">
                    <path
                        d="M81.952 21.15H78.08v3.87h3.873a1.66 1.66 0 0 1 1.659 1.663c0 .92-.74 1.66-1.66 1.66H78.08v3.872h3.873c3.056 0 5.532-2.478 5.532-5.532s-2.476-5.532-5.532-5.532zM59.88 41.624c4.636 0 8.632-2.715 10.5-6.645h4.937v6.645h2.764V34.98h3.873a8.3 8.3 0 0 0 8.301-8.297 8.3 8.3 0 0 0-8.301-8.299h-6.637v9.96h-3.94a11.62 11.62 0 0 0-11.497-9.959H46.26L32.7 41.624h3.232l3.872-6.645h13.923v6.645zm34.247-14.942c0 6.72-5.45 12.17-12.174 12.17V45.5h-10.5v-5.2c-2.843 3.2-6.966 5.2-11.563 5.2H49.865v-6.638h-7.827L38.166 45.5H25.873l18.07-30.98H59.88c4.598 0 8.72 2.006 11.564 5.184V14.5h10.5a12.18 12.18 0 0 1 12.174 12.172zM49.865 21.15v7.2h-6.178l-2.256 3.872h12.307V21.15zM68.734 30c0 4.9-3.966 8.85-8.854 8.85h-3.376v-3.87h3.376A4.98 4.98 0 0 0 64.862 30c0-2.747-2.23-4.98-4.982-4.98h-3.376v-3.87h3.376c4.888 0 8.854 3.962 8.854 8.85"
                        fill="currentColor" />
                </svg>
                <div class="sidebar__tagline">SenseLense</div>
            </div>

            <nav class="sidebar__nav">
                <div class="nav-section-label">Main</div>
                <a class="nav-item" href="index.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    Dashboard
                </a>
                <a class="nav-item" href="clients.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    Clients
                </a>
                <a class="nav-item" href="sessions.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                    Sessions
                </a>

                <div class="nav-section-label">Actions</div>
                <a class="nav-item" href="record.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="3" fill="currentColor" />
                    </svg>
                    New Session
                </a>

                
      <a class="nav-item" href="#" id="nav-tutorial" onclick="event.preventDefault();SLTutorial.open()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 0 3-3h7z"/></svg>
        Tutorial
      </a>

      <div class="nav-section-label">System</div>
                <a class="nav-item active" href="settings.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    Settings
                </a>
            </nav>

            <div class="sidebar__footer">
                <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5" />
                        <line x1="12" y1="1" x2="12" y2="3" />
                        <line x1="12" y1="21" x2="12" y2="23" />
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                        <line x1="1" y1="12" x2="3" y2="12" />
                        <line x1="21" y1="12" x2="23" y2="12" />
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                    </svg>
                    <span id="theme-label">Light Mode</span>
                    <div class="toggle-track">
                        <div class="toggle-thumb"></div>
                    </div>
                </button>
                <div class="status-badge" style="margin-top:10px">
                    <div class="status-dot" id="api-dot"></div>
                    <span id="api-text">Connecting‚Ä¶</span>
                </div>
            </div>
        </aside>

        <!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ -->
        <div class="main">
            <header class="topbar">
                <div>
                    <div class="topbar__title">Settings</div>
                    <div class="topbar__sub">Configure integrations, appearance, and preferences</div>
                </div>
                <div class="topbar__actions">
                    <button class="btn btn-primary" id="save-btn" onclick="saveAll()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                            <polyline points="17 21 17 13 7 13 7 21" />
                            <polyline points="7 3 7 8 15 8" />
                        </svg>
                        Save Changes
                    </button>
                </div>
            </header>

            <main class="page-content" style="max-width:760px">

                <!-- ‚îÄ‚îÄ Appearance ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5" />
                                <line x1="12" y1="1" x2="12" y2="3" />
                                <line x1="12" y1="21" x2="12" y2="23" />
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                                <line x1="1" y1="12" x2="3" y2="12" />
                                <line x1="21" y1="12" x2="23" y2="12" />
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">Appearance</div>
                            <div class="settings-section__sub">Customize the look and feel of SenseLense</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Theme</div>
                            <div class="settings-row__desc">Switch between dark and light mode</div>
                        </div>
                        <div class="pill-toggle">
                            <button id="pill-dark" onclick="setTheme('dark')">üåô Dark</button>
                            <button id="pill-light" onclick="setTheme('light')">‚òÄÔ∏è Light</button>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Sidebar Accent</div>
                            <div class="settings-row__desc">Brand color used throughout the interface ‚Äî click the swatch
                                to open color wheel</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:12px">
                            <label id="accent-swatch-label"
                                style="width:32px;height:32px;border-radius:50%;background:var(--red);border:2px solid var(--border);cursor:pointer;display:block;position:relative"
                                title="Click to pick color">
                                <input type="color" id="accent-picker" value="#CC0000"
                                    style="opacity:0;position:absolute;inset:0;width:100%;height:100%;cursor:pointer;border:none;padding:0" />
                            </label>
                            <div>
                                <div id="accent-hex"
                                    style="font-size:13px;color:var(--text-secondary);font-family:monospace">#CC0000
                                </div>
                                <div style="font-size:11px;color:var(--text-muted);margin-top:2px">Click swatch to
                                    change</div>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="resetAccent()">Reset to ADP Red</button>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ Backend ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                                <line x1="8" y1="21" x2="16" y2="21" />
                                <line x1="12" y1="17" x2="12" y2="21" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">Backend Connection</div>
                            <div class="settings-section__sub">Flask API server configuration</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Backend URL</div>
                            <div class="settings-row__desc">Where the Flask server is running</div>
                        </div>
                        <input type="url" id="cfg-backend-url" placeholder="http://localhost:5050" />
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">API Status</div>
                            <div class="settings-row__desc">Live connection check</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px">
                            <div class="status-dot" id="settings-api-dot"></div>
                            <span id="settings-api-text"
                                style="font-size:13px;color:var(--text-secondary)">Checking‚Ä¶</span>
                            <button class="btn btn-outline btn-sm" onclick="checkApi()">Retry</button>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ ElevenLabs ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                <line x1="12" y1="19" x2="12" y2="23" />
                                <line x1="8" y1="23" x2="16" y2="23" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">ElevenLabs Transcription</div>
                            <div class="settings-section__sub">Real-time speech-to-text for session recordings</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">API Key</div>
                            <div class="settings-row__desc">Your ElevenLabs secret key</div>
                        </div>
                        <input type="password" id="cfg-eleven-key" placeholder="xi-‚Ä¶" />
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Voice Model</div>
                            <div class="settings-row__desc">Transcription model to use</div>
                        </div>
                        <div class="pill-toggle">
                            <button class="active" id="pill-eleven-v1" onclick="setElevenModel('v1')">Standard</button>
                            <button id="pill-eleven-v2" onclick="setElevenModel('v2')">Turbo v2</button>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ Presage ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M23 7l-7 5 7 5V7z" />
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">Presage Emotion Tracking</div>
                            <div class="settings-section__sub">Face and emotion analysis via webcam</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Capture Interval</div>
                            <div class="settings-row__desc">How often Presage samples the camera (ms)</div>
                        </div>
                        <input type="text" id="cfg-presage-interval" placeholder="2400"
                            style="width:100px;text-align:center" />
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Emotions to Track</div>
                            <div class="settings-row__desc">Which facial emotions are recorded</div>
                        </div>
                        <div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end">
                            <span class="badge green">Happy</span>
                            <span class="badge blue">Engaged</span>
                            <span class="badge" style="background:rgba(234,179,8,.12);color:#EAB308">Confused</span>
                            <span class="badge">Neutral</span>
                            <span class="badge red">Displeased</span>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ Session Defaults ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">Session Defaults</div>
                            <div class="settings-section__sub">Pre-fill values for new recording sessions</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Default Session Title</div>
                            <div class="settings-row__desc">Auto-filled in the recording form</div>
                        </div>
                        <input type="text" id="cfg-default-title" placeholder="Discovery Call" />
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Auto-redirect After Session</div>
                            <div class="settings-row__desc">Go to session detail page when recording ends</div>
                        </div>
                        <div class="pill-toggle">
                            <button class="active" id="pill-redir-on" onclick="setRedir('on')">On</button>
                            <button id="pill-redir-off" onclick="setRedir('off')">Off</button>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ About ‚îÄ‚îÄ -->
                <div class="settings-section">
                    <div class="settings-section__header">
                        <div class="settings-section__icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="12" />
                                <line x1="12" y1="16" x2="12.01" y2="16" />
                            </svg>
                        </div>
                        <div>
                            <div class="settings-section__title">About SenseLense</div>
                            <div class="settings-section__sub">Version and project info</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Version</div>
                            <div class="settings-row__desc">Current build</div>
                        </div>
                        <span class="badge green">v1.0.0 - Hackathon</span>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Stack</div>
                            <div class="settings-row__desc">Technologies powering SenseLense</div>
                        </div>
                        <div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end">
                            <span class="badge">Flask</span>
                            <span class="badge">SQLite</span>
                            <span class="badge blue">ElevenLabs</span>
                            <span class="badge red">Presage</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div>
                            <div class="settings-row__label">Repository</div>
                            <div class="settings-row__desc">Source code on GitHub</div>
                        </div>
                        <a href="https://github.com/VictorJimenez3/SenseLense" target="_blank"
                            class="btn btn-outline btn-sm">
                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
                            </svg>
                            VictorJimenez3/SenseLense
                        </a>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // ‚îÄ‚îÄ Theme helpers (inlined ‚Äî no ES module imports needed on file://) ‚îÄ‚îÄ
        const THEME_KEY = "sl-theme";

        function applyTheme() {
            const t = localStorage.getItem(THEME_KEY) || "dark";
            document.documentElement.setAttribute("data-theme", t === "light" ? "light" : "");
        }
        function currentTheme() { return localStorage.getItem(THEME_KEY) || "dark"; }

        applyTheme();

        function syncThemePills() {
            const t = currentTheme();
            document.getElementById("pill-dark").classList.toggle("active", t !== "light");
            document.getElementById("pill-light").classList.toggle("active", t === "light");
            const lbl = document.getElementById("theme-label");
            if (lbl) lbl.textContent = t === "light" ? "Dark Mode" : "Light Mode";
        }

        function toggleTheme() {
            const next = currentTheme() === "dark" ? "light" : "dark";
            localStorage.setItem(THEME_KEY, next);
            document.documentElement.setAttribute("data-theme", next === "light" ? "light" : "");
            syncThemePills();
        }

        function setTheme(t) {
            localStorage.setItem(THEME_KEY, t);
            document.documentElement.setAttribute("data-theme", t === "light" ? "light" : "");
            syncThemePills();
        }

        // ‚îÄ‚îÄ ElevenLabs model pill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function setElevenModel(m) {
            document.getElementById("pill-eleven-v1").classList.toggle("active", m === "v1");
            document.getElementById("pill-eleven-v2").classList.toggle("active", m === "v2");
            localStorage.setItem("sl-eleven-model", m);
        }

        // ‚îÄ‚îÄ Redirect pill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function setRedir(v) {
            document.getElementById("pill-redir-on").classList.toggle("active", v === "on");
            document.getElementById("pill-redir-off").classList.toggle("active", v === "off");
            localStorage.setItem("sl-redir", v);
        }

        // ‚îÄ‚îÄ Accent color ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function applyAccent(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            const root = document.documentElement;
            root.style.setProperty('--red', hex);
            root.style.setProperty('--red-light', `rgb(${Math.min(255, r + 30)},${Math.min(255, g + 30)},${Math.min(255, b + 30)})`);
            root.style.setProperty('--red-dark', `rgb(${Math.floor(r * .72)},${Math.floor(g * .72)},${Math.floor(b * .72)})`);
            root.style.setProperty('--red-glow', `rgba(${r},${g},${b},.25)`);
            root.style.setProperty('--border-red', `rgba(${r},${g},${b},.4)`);
            localStorage.setItem('sl-accent', hex);
            // Update inline SVG logo color live
            const logo = document.getElementById('adp-logo');
            if (logo) logo.style.color = hex;
            // Update swatch and label
            const swatch = document.getElementById('accent-swatch-label');
            const hexEl = document.getElementById('accent-hex');
            if (swatch) swatch.style.background = hex;
            if (hexEl) hexEl.textContent = hex.toUpperCase();
        }

        function resetAccent() {
            localStorage.removeItem('sl-accent');
            const root = document.documentElement;
            // Remove overrides so CSS defaults kick back in
            ['--red', '--red-light', '--red-dark', '--red-glow', '--border-red'].forEach(p => root.style.removeProperty(p));
            const swatch = document.getElementById('accent-swatch-label');
            const hexEl = document.getElementById('accent-hex');
            if (swatch) swatch.style.background = '';
            if (hexEl) hexEl.textContent = '#CC0000';
            const picker = document.getElementById('accent-picker');
            if (picker) picker.value = '#CC0000';
            toast('Accent reset to ADP Red', 'info');
        }

        // ‚îÄ‚îÄ API health check ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function checkApi() {
            const dot = document.getElementById("settings-api-dot");
            const text = document.getElementById("settings-api-text");
            const url = (document.getElementById("cfg-backend-url").value.trim() || "http://localhost:5050") + "/api/health";
            try {
                const r = await fetch(url);
                if (r.ok) {
                    dot.className = "status-dot online";
                    text.textContent = "Backend online";
                    text.style.color = "";
                } else { throw new Error(); }
            } catch {
                dot.className = "status-dot";
                text.style.color = "var(--negative)";
                text.textContent = "Cannot reach backend";
            }
        }

        // ‚îÄ‚îÄ Toast (inlined) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toast(msg, type) {
            const c = document.getElementById("toast-container");
            const t = document.createElement("div");
            t.className = "toast " + (type || "");
            t.textContent = msg;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        // ‚îÄ‚îÄ Save all ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function saveAll() {
            const data = {
                backendUrl: document.getElementById("cfg-backend-url").value.trim(),
                elevenKey: document.getElementById("cfg-eleven-key").value.trim(),
                presageInterval: document.getElementById("cfg-presage-interval").value.trim(),
                defaultTitle: document.getElementById("cfg-default-title").value.trim(),
            };
            localStorage.setItem("sl-settings", JSON.stringify(data));
            toast("Settings saved!", "success");
        }

        // ‚îÄ‚îÄ Init on load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener("DOMContentLoaded", () => {
            syncThemePills();

            const savedModel = localStorage.getItem("sl-eleven-model") || "v1";
            setElevenModel(savedModel);

            const savedRedir = localStorage.getItem("sl-redir") || "on";
            setRedir(savedRedir);

            // Accent color picker
            const picker = document.getElementById('accent-picker');
            const savedAccent = localStorage.getItem('sl-accent') || '#CC0000';
            picker.value = savedAccent;
            // Apply visually (CSS vars may already be set by head script, but update swatch)
            const swatch = document.getElementById('accent-swatch-label');
            const hexEl = document.getElementById('accent-hex');
            if (swatch) swatch.style.background = savedAccent;
            if (hexEl) hexEl.textContent = savedAccent.toUpperCase();

            picker.addEventListener('input', e => applyAccent(e.target.value));
            picker.addEventListener('change', e => { applyAccent(e.target.value); toast('Accent color saved!', 'success'); });

            const saved = JSON.parse(localStorage.getItem("sl-settings") || "{}");
            document.getElementById("cfg-backend-url").value = saved.backendUrl || "http://localhost:5050";
            document.getElementById("cfg-eleven-key").value = saved.elevenKey || "";
            document.getElementById("cfg-presage-interval").value = saved.presageInterval || "2400";
            document.getElementById("cfg-default-title").value = saved.defaultTitle || "";

            checkApi();
        });
    </script>

<script src="js/tutorial.js"></script>
</body>

</html>