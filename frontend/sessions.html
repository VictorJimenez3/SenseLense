<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SenseLense — Sessions</title>
    <meta name="description" content="View all recorded ADP sales sessions and their insights." />
    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
    <div class="app-shell">

        <aside class="sidebar">
            <div class="sidebar__logo">
                <img src="assets/adp-logo.svg" alt="ADP" />
                <div class="sidebar__tagline">SenseLense</div>
            </div>
            <nav class="sidebar__nav">
                <div class="nav-section-label">Main</div>
                <a class="nav-item" href="index.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    Dashboard
                </a>
                <a class="nav-item" href="clients.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    Clients
                </a>
                <a class="nav-item active" href="sessions.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                    Sessions
                </a>
                <div class="nav-section-label">Actions</div>
                <a class="nav-item" href="record.html">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="3" fill="currentColor" />
                    </svg>
                    New Session
                </a>
            </nav>
            <div class="sidebar__footer">
                <div class="status-badge">
                    <div class="status-dot online"></div>
                    <span>Backend</span>
                </div>
            </div>
        </aside>

        <div class="main">
            <header class="topbar">
                <div>
                    <div class="topbar__title">Sessions</div>
                    <div class="topbar__sub">All recorded conversations</div>
                </div>
                <div class="topbar__actions">
                    <div class="search-wrap">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                        <input type="text" id="session-search" placeholder="Search sessions…" />
                    </div>
                    <a href="record.html" class="btn btn-primary">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <circle cx="12" cy="12" r="3" fill="currentColor" stroke="none" />
                        </svg>
                        New Session
                    </a>
                </div>
            </header>

            <main class="page-content">
                <div class="card" style="padding:0;overflow:hidden">
                    <div id="sessions-table-wrap">
                        <div class="empty-state" style="padding:80px 20px">
                            <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            <h3>No sessions recorded</h3>
                            <p>Start your first recording session.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="toast-container"></div>

    <script type="module">
        import { api } from "./js/api.js";
        import { toast, fmtDate, sentimentLabel } from "./js/utils.js";

        let allSessions = [];

        async function load() {
            try {
                allSessions = await api.getSessions();
                render(allSessions);
            } catch {
                toast("Failed to load sessions", "error");
            }
        }

        function render(sessions) {
            const wrap = document.getElementById("sessions-table-wrap");
            if (!sessions.length) {
                wrap.innerHTML = `<div class="empty-state" style="padding:80px 20px">
      <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/></svg>
      <h3>No sessions found</h3><p>Try a different search.</p>
    </div>`;
                return;
            }
            wrap.innerHTML = `<table class="data-table">
    <thead><tr>
      <th>Title</th><th>Date</th><th>Sentiment</th><th>Engagement</th><th>Status</th>
    </tr></thead>
    <tbody>${sessions.map(s => {
                const { label, cls } = sentimentLabel(s.overall_sentiment);
                return `<tr onclick="location='session.html?id=${s.id}'" style="cursor:pointer">
        <td>${s.title}</td>
        <td>${fmtDate(s.started_at)}</td>
        <td><span class="emotion-pill ${cls}">${label}</span></td>
        <td>${s.engagement_score ? Math.round(s.engagement_score) + "%" : "—"}</td>
        <td><span class="badge ${s.ended_at ? "green" : "red"}">${s.ended_at ? "Complete" : "Live"}</span></td>
      </tr>`;
            }).join("")}</tbody>
  </table>`;
        }

        document.getElementById("session-search").addEventListener("input", e => {
            const q = e.target.value.toLowerCase();
            render(allSessions.filter(s => s.title.toLowerCase().includes(q)));
        });

        load();
    </script>
</body>

</html>